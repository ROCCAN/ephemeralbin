<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EphemeralBin</title>
    <style>
        :root {
            --background-color: #1e1e1e;
            --editor-background: #2a2a2a;
            --text-color: #d4d4d4;
            --primary-color: #61afef;
            --border-color: #3e3e3e;
            --button-bg: #333;
            --button-hover-bg: #444;
            --footer-text: #888;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        main {
            flex-grow: 1;
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem 1rem;
            display: flex;
            flex-direction: column;
        }

        header {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        h1 {
            color: var(--primary-color);
            font-size: 2.5rem;
            font-weight: 500;
        }
        
        h1 + p {
            font-size: 1.1rem;
            opacity: 0.8;
        }

        textarea#editor {
            flex-grow: 1;
            width: 100%;
            min-height: 40vh;
            background-color: var(--editor-background);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 1rem;
            font-family: 'Menlo', 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 1rem;
            resize: vertical;
            transition: border-color 0.2s;
        }
        
        textarea#editor:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .controls {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 1rem;
        }

        .controls button {
            font-size: 1rem;
            padding: 0.5rem 1rem;
            background-color: var(--button-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .controls button:hover {
            background-color: var(--button-hover-bg);
        }

        #status {
            text-align: right;
            margin-top: 0.5rem;
            height: 1.2em;
            font-size: 0.9rem;
            color: var(--primary-color);
        }

        footer {
            text-align: center;
            padding: 1.5rem;
            font-size: 0.9rem;
            color: var(--footer-text);
            border-top: 1px solid var(--border-color);
        }
        
        footer a {
            color: var(--primary-color);
            text-decoration: none;
        }
    </style>
</head>
<body>

    <main>
        <header>
            <h1>EphemeralBin</h1>
            <p>Your data lives in the URL. No server. No logs. No limits... except your browser's.</p>
        </header>

        <textarea id="editor" placeholder="Paste your text here. The URL will update automatically as you type..."></textarea>
        
        <div id="status"></div>
        
        <div class="controls">
            <button id="copyUrlButton">Copy Sharable URL</button>
            <button id="clearButton">Clear</button>
        </div>
    </main>

    <footer>
        <p>
            <strong>How it works:</strong> All content is encoded and stored in the URL's fragment (#). 
            When you share the URL, you share the data. It is never sent to a server.
            <br>
            Bookmark this page to use it anytime, even offline.
        </p>
    </footer>

    <script>
        const editor = document.getElementById('editor');
        const copyUrlButton = document.getElementById('copyUrlButton');
        const clearButton = document.getElementById('clearButton');
        const statusEl = document.getElementById('status');
        
        // --- Unicode-safe Base64 Encoding/Decoding ---
        // The standard btoa() and atob() functions fail on multi-byte characters.
        // These helpers ensure Unicode (like emojis or non-English text) works correctly.
        const toBase64 = (str) => {
            try {
                // 1. String to UTF-8 byte array
                const bytes = new TextEncoder().encode(str);
                // 2. Byte array to a string of binary character codes
                const binString = Array.from(bytes, (byte) => String.fromCodePoint(byte)).join("");
                // 3. Binary string to Base64
                return btoa(binString);
            } catch (error) {
                console.error("Encoding failed:", error);
                return '';
            }
        };

        const fromBase64 = (base64) => {
            try {
                // 1. Base64 to binary string
                const binString = atob(base64);
                // 2. Binary string to UTF-8 byte array
                const bytes = Uint8Array.from(binString, (m) => m.codePointAt(0));
                // 3. UTF-8 byte array to string
                return new TextDecoder().decode(bytes);
            } catch (error) {
                console.error("Decoding failed:", error);
                statusEl.textContent = "Error: Invalid or corrupted data in URL.";
                return '';
            }
        };

        // --- Core Application Logic ---

        const updateUrl = () => {
            const content = editor.value;
            if (content) {
                const encodedContent = toBase64(content);
                // Use replaceState to avoid cluttering browser history with every keystroke
                history.replaceState(null, '', '#' + encodedContent);
            } else {
                // If the editor is empty, clean up the URL
                history.replaceState(null, '', window.location.pathname + window.location.search);
            }
            checkUrlLength();
        };

        const loadFromUrl = () => {
            const hash = window.location.hash.substring(1); // Remove the '#'
            if (hash) {
                const decodedContent = fromBase64(hash);
                editor.value = decodedContent;
                checkUrlLength();
            }
        };

        const checkUrlLength = () => {
            const len = window.location.href.length;
            if (len > 8000) { // Most modern browsers support very long URLs, but warn at a high threshold.
                statusEl.textContent = `Warning: URL is very long (${len} chars). May not work everywhere.`;
            } else if (len > 2000) {
                 statusEl.textContent = `URL length: ${len} characters.`;
            } else {
                if (statusEl.textContent.startsWith("Warning") || statusEl.textContent.startsWith("URL length")) {
                    statusEl.textContent = '';
                }
            }
        };

        // --- Event Listeners ---

        // Use a slight debounce to avoid hammering the history API on very fast typing.
        let debounceTimer;
        editor.addEventListener('input', () => {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(updateUrl, 100);
        });

        copyUrlButton.addEventListener('click', async () => {
            try {
                await navigator.clipboard.writeText(window.location.href);
                statusEl.textContent = "URL copied to clipboard!";
            } catch (err) {
                statusEl.textContent = "Failed to copy URL.";
                console.error('Failed to copy: ', err);
            }
            setTimeout(() => { 
                if (statusEl.textContent === "URL copied to clipboard!") {
                   statusEl.textContent = '';
                   checkUrlLength(); // Restore length warning if needed
                }
            }, 2000);
        });

        clearButton.addEventListener('click', () => {
            editor.value = '';
            updateUrl();
            statusEl.textContent = 'Cleared.';
            setTimeout(() => { 
                if (statusEl.textContent === 'Cleared.') {
                    statusEl.textContent = '';
                }
            }, 1500);
        });

        // Load content from URL when the page first loads
        window.addEventListener('DOMContentLoaded', loadFromUrl);
        // Also listen for hash changes if the user uses back/forward buttons
        window.addEventListener('hashchange', loadFromUrl);

    </script>

</body>
</html>